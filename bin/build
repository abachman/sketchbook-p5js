#!/usr/bin/env node

// const { spawn } = require("node:child_process");
// const EventSource = require("eventsource");
const { p5jsPlugin } = require("../src/build/p5js_plugin.js");
const esbuild = require("esbuild");

async function build() {
  let ctx = await esbuild.context({
    entryPoints: ['src/index.js'],
    outfile: 'public/bundle.js',
    bundle: true,
    target: 'es2020',
    plugins: [p5jsPlugin],
  })

  await ctx.watch()

  let { host, port } = await ctx.serve({
    servedir: 'public',
  })

  console.log(`Serving on http://${host}:${port}`)
}

build().catch(() => process.exit(1))
